---
title: "dispRity manual"
author: "Thomas Guillerme"
date: "`r Sys.Date()`"
output:
    rmarkdown::html_vignette:
        toc: true
        toc_depth: 2
bibliography: References.bib
bst: sysbio.bst
vignette: >
  %\VignetteIndexEntry{dispRity manual}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

# `dispRity`

This is a package for measuring disparity in `R`. It allows users to summarise ordinated matrices (e.g. MDS, PCA, PCO, PCoA) into single values so they can easily be compared.
<!-- Add version and table of content here! -->

# Introduction

## What's `dispRity`
This is a package for measuring disparity in `R`.
It allows users to summarise ordinated matrices (e.g. MDS, PCA, PCO, PCoA) to perform some multidimensional analysis.
Typically, these analysis are used in palaeobiology to study the changes in morphology through time.


## Installing and running the package

You can install this package easily if you use the latest version of `R` (> 3.0.0) and `devtools`.

```{r, eval = FALSE}
## Checking if devtools is already installed
if(!require(devtools)) install.packages("devtools")

## Installing the latest released version directly from GitHub
install_github("TGuillerme/dispRity", ref = "release")

## Loading the package
library(dispRity)
```

```{r, eval = TRUE, echo = FALSE, message = FALSE}
## Checking if Claddis is installed BUILD ONLY
library(dispRity)
```

Note this uses the `release` branch (version`0.4`). <!-- add version !-->
For the piping-hot (but potentially full of bugs) version, you can change the argument `ref = release` to `ref = master`.
`dispRity` depends mainly on the `ape` package and uses functions from several other packages (`ade4`, `geometry`, `grDevices`, `hypervolume`, `paleotree`, `snow`, and `RCurl`).

## Why not CRAN

This package is not readily available on CRAN.
This is mainly because some parts are still in development and that I prefer the reactivity of GitHub for implementing new suggestions from users.
However, the package follows the strict (and useful!) CRAN standards via Travis. <!-- add link !-->

## Help

If you need help about the package, I hope that the following manual will be useful.
If you still need more help, do not hesitate to drop me an email!

Parts of this package are still in development and some other parts are probably not covered.
Thus if you have suggestions or comments on on what has already been developed or will be developed, please send me an email (<guillert@tcd.ie>) or if you are a GitHub user, directly create an issue on the [GitHub page](https://github.com/TGuillerme/dispRity).


# Getting started

## Which data?

Disparity must be measured from ordinated matrices.
These matrices can be of any type of ordination (PCO, PCA, PCoA, MDS, etc.) as long as they have your elements names as rows (taxa, experiments, countries, etc.) and your ordinations axis as columns (the dimensions of your dataset).

### Ordination from `Claddis`

```{r, eval = TRUE, echo = FALSE, message = FALSE}
## Checking if Claddis is installed BUILD ONLY
if(!require(Claddis)) install.packages("Claddis")
```
`dispRity` package can easily take data from `Claddis` using the `Claddis.ordination` function.
For this, simply input a matrix in the `Claddis` format to the function an it will automatically calculate and ordinate the distances among taxa:

```{r}
## Ordinating the example data from Claddis
Claddis.ordination(Michaux1989) 
```

Note that some several options are available, namely which type of distance should be computed.
See more info in the function manual (`?Claddis.ordination`).
Alternatively, it is of course also possible to manual calculate the ordination matrix using the functions `Claddis::MorphDistMatrix` and `stats::cmdscale`.

### Ordination from `geomorph`

> TBC!

### General ordinations

If you are not using the packages mentioned above (`Claddis` and `geomorph`) you can easily make your own ordinations by using the following functions from the `stats` package.
Here is how to do it for the following types of matrices:

 * Multivariate matrices

```{r}
## A multivariate matrix
head(USArrests)

## Ordinating the matrix using prcomp()
ordination <- prcomp(USArrests)

## Selecting the ordinated matrix
ordinated_matrix <- ordination$x
head(ordinated_matrix)
```
This results in a ordinated matrix with US states as elements and four dimensions (PC 1 to 4). For an alternative method, have a look at the `?princomp` function.

 * Distance matrices

```{r}
## A matrix of distances between cities
str(eurodist)

## Ordinating the matrix using cmdscale() with k = 5 dimensions
ordinated_matrix <- cmdscale(eurodist, k = 5)
head(ordinated_matrix)
```
This results in a ordinated matrix with European cities as elements and 5 dimensions.
Note that the number of dimensions should not exceed the number of elements - 1.

Of course any other methods for creating the ordination matrix is totally valid!
The only requirements for `dispRity` is to use matrices with elements as rows and dimensions as columns...


## Simple analysis

Two functions allow to run templated analysis simply using an ordination matrix: either calculating the disparity through time or the disparity per groups.

### Example data

For illustrating the following functions, we will use data from Beck and Lee 2015. <!-- ADD PAPER CITE HERE -->
This dataset contains an ordinated matrix of 50 mammals' discrete characters (called `BeckLee_mat50`), a matrix of the same 50 mammals and the estimate discrete data from their descendants (thus 50 + 49 rows, called `BeckLee_mat99`), a data frame containing the ages of each taxa in the dataset (called `BeckLee_ages`) and finally a phylogenetic tree with the relations of the 50 mammals (called `BeckLee_tree`).

```{r, fig.width=6, fig.height=6}
## Setting the random seed for repeatability
set.seed(123)

## Loading the ordinated matrices
data(BeckLee_mat50)
data(BeckLee_mat99)

## The first 5 taxa and dimensions of the 50 taxa matrix
head(BeckLee_mat50[,1:5])

## The first 5 taxa and dimensions of the 99 taxa + ancestors matrix
head(BeckLee_mat99[,1:5])
tail(BeckLee_mat99[,1:5])

## Loading a list of first and last occurrence data
data(BeckLee_ages)
head(BeckLee_ages)

## Loading the phylogeny
data(BeckLee_tree)
plot(BeckLee_tree, cex = 0.8) ; axisPhylo(root = 140) ; nodelabels(cex = 0.5)
```

Note of course that you can use your data obtain from the previous chapter!


### Disparity through time

This

```{r}
# dispRity.through.time()
```

### Disparity between groups

```{r}
# dispRity.per.group()
```

# Specific tutorials

# Glossary <a name="glossary"></a>

-   **Ordinated space**. The mathematical multidimensional object that will be analysed with this package.
    In morphometrics, this is often referred to as the morphospace.
    However it may also be referred to as the cladisto-space for cladistic data or the eco-space for ecological data etc.
    In practice, this term designates an ordinated matrix where the columns represent the dimensions of the space (often â€“ but not necessarily - > 3!) and the rows represent the elements within this space.

-   **Elements**. The rows of the ordinated space. Elements can be taxa, field sites, countries etc.

-   **Dimensions**. The columns of the ordinated space. The dimensions are referred to as axes of variation, or principal components, for ordinated spaces obtained from a PCA.

-   **Subsamples**. Sub-samples of the ordinated space.
    A sub-sample (or subsamples) contains the same number of dimensions as the ordinated space but may contain a smaller subset of elements.
    For example, if our ordinated space is composed of birds and mammals (the elements) and 50 principal components (the dimensions), we can create two subsamples containing just mammals or birds, but with the same 50 dimensions, to compare disparity in the two clades.




# The package's guts

## Running `dispRity` in parallel

## `dispRity` object structure

## Modularity

### Making your own metrics

### Making your own tests

## Where is this going?
