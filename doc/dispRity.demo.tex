\documentclass{article}\usepackage[]{graphicx}\usepackage[]{color}
%% maxwidth is the original width if it is less than linewidth
%% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}
\usepackage[sc]{mathpazo}
\usepackage[T1]{fontenc}
\usepackage{geometry}
\geometry{verbose,tmargin=2.5cm,bmargin=2.5cm,lmargin=2.5cm,rmargin=2.5cm}
\setcounter{secnumdepth}{2}
\setcounter{tocdepth}{2}
\usepackage{url}
\usepackage[unicode=true,pdfusetitle,
 bookmarks=true,bookmarksnumbered=true,bookmarksopen=true,bookmarksopenlevel=2,
 breaklinks=false,pdfborder={0 0 1},backref=false,colorlinks=false]
 {hyperref}
\hypersetup{
 pdfstartview={XYZ null null 1}}

\newcommand{\dispRity}{\texttt{dispRity} }
\newcommand{\R}{\texttt{R} }
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}



\title{dispRity demo}


\author{Thomas Guillerme}

\maketitle

This a quick demo to go through the beta version of the \dispRity package (v.0.1.0).
Many parts are still missing (see section \ref{whatsleft}) but this version should be running all right and give an idea of what's implemented in the package.

\section{Before starting}

\dispRity is a package for calculating disparity in \R.
What is disparity? Well that's a more complex question...
To keep it short, this package allows to summarise ordinated matrices (e.g. MDS, PCA, PCO, PCoA) into single values.
% More explanations to put here?

\subsection{Installation}
You can install this package pretty easily if you use the latest version of \R and \texttt{devtools}.
Just copy past the following
\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{install.packages}\hlstd{(}\hlstr{"devtools"}\hlstd{)}
\hlkwd{library}\hlstd{(devtools)}
\hlkwd{install_github}\hlstd{(}\hlstr{"TGuillerme/dispRity"}\hlstd{,} \hlkwc{ref}\hlstd{=}\hlstr{"release"}\hlstd{)}
\hlkwd{library}\hlstd{(dispRity)}
\end{alltt}
\end{kframe}
\end{knitrout}

Note that we use here the \texttt{release} branch which is version 0.1.0.
If you want the piping-hot (and full of bugs) version, change the option \texttt{ref="release"} to \texttt{ref="master"}.

This package depends heavily on the \texttt{ape} package as well as the nice function \texttt{timeSliceTree::paleotree}.
However, I recommend to also install the packages \texttt{geomorph} or \texttt{Claddis} if you want to try this example on your own morphometric or cladistic data.

\subsection{Which data?}
In this demo we are going to use the data from Beck and Lee 2014 \cite{beckancient2014}:

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Loading demo and the package data}
\hlkwd{library}\hlstd{(dispRity)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: paleotree}}\begin{alltt}
\hlcom{## An ordinated matrix with the tips only}
\hlkwd{data}\hlstd{(BeckLee_mat50)}
\hlkwd{dim}\hlstd{(BeckLee_mat50)}
\end{alltt}
\begin{verbatim}
## [1] 50 48
\end{verbatim}
\begin{alltt}
\hlkwd{head}\hlstd{(BeckLee_mat50[,}\hlnum{1}\hlopt{:}\hlnum{5}\hlstd{])}
\end{alltt}
\begin{verbatim}
##                    [,1]          [,2]        [,3]       [,4]      [,5]
## Cimolestes   -0.5319679  0.1117759259  0.09865194 -0.1933148 0.2035833
## Maelestes    -0.4087147  0.0139690317  0.26268300  0.2297096 0.1310953
## Batodon      -0.6923194  0.3308625215 -0.10175223 -0.1899656 0.1003108
## Bulaklestes  -0.6802291 -0.0134872777  0.11018009 -0.4103588 0.4326298
## Daulestes    -0.7386111  0.0009001369  0.12006449 -0.4978191 0.4741342
## Uchkudukodon -0.5105254 -0.2420633915  0.44170317 -0.1172972 0.3602273
\end{verbatim}
\begin{alltt}
\hlcom{## An ordinated matrix with the tips and the nodes (named nX)}
\hlkwd{data}\hlstd{(BeckLee_mat99)}
\hlkwd{dim}\hlstd{(BeckLee_mat99)}
\end{alltt}
\begin{verbatim}
## [1] 99 97
\end{verbatim}
\begin{alltt}
\hlkwd{head}\hlstd{(BeckLee_mat99[,}\hlnum{1}\hlopt{:}\hlnum{5}\hlstd{],} \hlnum{2}\hlstd{)}
\end{alltt}
\begin{verbatim}
##                  [,1]       [,2]       [,3]       [,4]        [,5]
## Cimolestes -0.6082437 -0.0323683 0.08458885 -0.4338448 -0.30536875
## Maelestes  -0.5730206 -0.2840361 0.01308847 -0.1258848  0.06123611
\end{verbatim}
\begin{alltt}
\hlkwd{tail}\hlstd{(BeckLee_mat99[,}\hlnum{1}\hlopt{:}\hlnum{5}\hlstd{],} \hlnum{2}\hlstd{)}
\end{alltt}
\begin{verbatim}
##            [,1]      [,2]       [,3]       [,4]       [,5]
## n48 -0.05529018 0.4799330 0.04118477 0.04944912 -0.3558830
## n49 -0.13067785 0.4478168 0.11956268 0.13800340 -0.3222785
\end{verbatim}
\begin{alltt}
\hlcom{## A list of first and last occurence data for some fossils}
\hlkwd{data}\hlstd{(BeckLee_ages)}
\hlkwd{head}\hlstd{(BeckLee_ages)}
\end{alltt}
\begin{verbatim}
##             FAD  LAD
## Adapis     37.2 36.8
## Asioryctes 83.6 72.1
## Leptictis  33.9 33.3
## Miacis     49.0 46.7
## Mimotona   61.6 59.2
## Notharctus 50.2 47.0
\end{verbatim}
\begin{alltt}
\hlcom{## And a phylogeny:}
\hlkwd{data}\hlstd{(BeckLee_tree)}
\hlkwd{plot}\hlstd{(BeckLee_tree) ;} \hlkwd{nodelabels}\hlstd{(}\hlkwc{cex}\hlstd{=}\hlnum{0.8}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=.8\linewidth]{figure/minimal-data-1} 

}



\end{knitrout}

However, I greatly encourage you to use your own data (after all, that's the point of an \R package).
You will simply need a ordinated distance matrix (make sure that the number of column is at maximum the number of rows minus one) and a phylogenetic tree (with the tips matching the ordinated matrix).
Just replace all the \texttt{BeckLee} mentions in this demo by your very own data!

\section{A super quick go through}
This package allows the following:
\begin{enumerate}
    \item Splitting the data
    \item Bootstrapping the data
    \item Calculating disparity
    \item Summarising the results
\end{enumerate}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Splitting the data}
\hlstd{sliced_data} \hlkwb{<-} \hlkwd{time.series}\hlstd{(BeckLee_mat99, BeckLee_tree,} \hlkwc{method} \hlstd{=} \hlstr{"continuous"}\hlstd{,}
    \hlkwc{model} \hlstd{=} \hlstr{"acctran"}\hlstd{,} \hlkwc{time} \hlstd{=} \hlnum{5}\hlstd{,} \hlkwc{FADLAD} \hlstd{= BeckLee_ages)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Some tips have FAD/LAD and are assumed to interval single points in time.}}\begin{alltt}
\hlcom{## Bootstrapping the data}
\hlstd{bootstrapped_data} \hlkwb{<-} \hlkwd{boot.matrix}\hlstd{(sliced_data,} \hlnum{100}\hlstd{)}

\hlcom{## Calculating disparity}
\hlstd{sum_of_ranges} \hlkwb{<-} \hlkwd{dispRity}\hlstd{(bootstrapped_data,} \hlkwc{metric} \hlstd{=} \hlkwd{c}\hlstd{(sum, ranges))}

\hlcom{## Summarising the results}
\hlkwd{summary}\hlstd{(sum_of_ranges)}
\end{alltt}
\begin{verbatim}
##      series  n  mean  2.5%   25%   75% 97.5%
## 1 133.51104  3 17.81  0.00 15.51 24.35 24.35
## 2 100.13328 14 52.05 45.80 49.90 54.50 57.67
## 3  66.75552 23 64.80 59.23 63.20 66.57 69.25
## 4  33.37776 11 42.95 37.94 41.40 44.77 47.43
## 5         0 10 40.94 35.13 39.22 42.69 46.13
\end{verbatim}
\begin{alltt}
\hlkwd{plot}\hlstd{(sum_of_ranges,} \hlkwc{type} \hlstd{=} \hlstr{"continuous"}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=.5\linewidth]{figure/minimal-Quick_go-1} 

}



\end{knitrout}

Et voil\`{a}...

\section{In more details}

\subsection{The \dispRity objects}
Disparity analysis involve a lot of shuffling around with many matrices (especially when bootstrapping the data) which can be a bit impractical to visualise and quickly jam your \R console.
For example, try to use \texttt{str} to show the structure of the object created above:

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{str}\hlstd{(sum_of_ranges)}
\end{alltt}
\end{kframe}
\end{knitrout}

Therefore this package proposes a new class of object called \dispRity (how unexpected!) that allow to use a \texttt{S3 print.dispRity} method.
In other words, when you are creating objects using the \dispRity functions, you can quickly and easily have a look at them by just printing it.
For example:

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Which class is the sum_of_ranges object?}
\hlkwd{class}\hlstd{(sum_of_ranges)}
\end{alltt}
\begin{verbatim}
## [1] "dispRity"
\end{verbatim}
\begin{alltt}
\hlcom{## We can summarise it using the S3 method print.dispRity}
\hlstd{sum_of_ranges}
\end{alltt}
\begin{verbatim}
## Disparity measurements across 5 series for 99 taxa. 
## Series:
## 133.51104, 100.13328, 66.75552, 33.37776, 0.
## Disparity calculated as: sum ranges for 97 dimensions.
## Data was split using continuous method.
## Data was bootstrapped 100 times, using the full bootstrap method.
\end{verbatim}
\end{kframe}
\end{knitrout}

Note that each object output from different functions will show summarise slightly different informations.

\subsection{Splitting the data}
One of the first functionality of this package is to facilitate splitting the ordinated matrix in subsamples.
The original ordinated matrix represents the total any-o-space.

\subsubsection{Custom splitting}
\texttt{cust.series} is a fairly straightforward function and allows to split the data according to a factor determined by the user.
For example, here we can split the matrix based on phylogeny: let's classify in two different groups the crown and stem mammals present in the tree.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## We want to separate the species around the node 71 (see phylogeny above).}
\hlcom{## All the descendant are crown and all the ancestors are stem}
\hlstd{crown} \hlkwb{<-} \hlkwd{extract.clade}\hlstd{(BeckLee_tree,} \hlkwc{node} \hlstd{=} \hlnum{71}\hlstd{)}\hlopt{$}\hlstd{tip.label}
\hlstd{stem} \hlkwb{<-} \hlkwd{drop.tip}\hlstd{(BeckLee_tree,} \hlkwc{tip} \hlstd{= crown)}\hlopt{$}\hlstd{tip.label}

\hlcom{## We then have to feed this information in a data.frame with one column}
\hlstd{factors} \hlkwb{<-} \hlkwd{as.data.frame}\hlstd{(}
    \hlkwd{matrix}\hlstd{(}\hlkwc{data} \hlstd{=} \hlkwd{c}\hlstd{(}\hlkwd{rep}\hlstd{(}\hlstr{"crown"}\hlstd{,} \hlkwd{length}\hlstd{(crown)),} \hlkwd{rep}\hlstd{(}\hlstr{"stem"}\hlstd{,} \hlkwd{length}\hlstd{(stem))),}
    \hlkwc{ncol} \hlstd{=} \hlnum{1}\hlstd{,} \hlkwc{dimnames} \hlstd{=} \hlkwd{list}\hlstd{(}\hlkwd{c}\hlstd{(crown, stem))))}

\hlcom{## Then we can use the customised series function}
\hlstd{crown_stem} \hlkwb{<-} \hlkwd{cust.series}\hlstd{(BeckLee_mat50, factors)}

\hlcom{## This created a dispRity object containing two series: crown and stem}
\hlkwd{class}\hlstd{(crown_stem)}
\end{alltt}
\begin{verbatim}
## [1] "dispRity"
\end{verbatim}
\begin{alltt}
\hlstd{crown_stem}
\end{alltt}
\begin{verbatim}
## 2 custom series for 50 taxa. 
## Series:
## crown, stem.
\end{verbatim}
\begin{alltt}
\hlcom{## This object contains three elements}
\hlkwd{names}\hlstd{(crown_stem)}
\end{alltt}
\begin{verbatim}
## [1] "data"   "taxa"   "series"
\end{verbatim}
\begin{alltt}
\hlcom{## With "data" being the list sub-matrices}
\hlkwd{str}\hlstd{(crown_stem}\hlopt{$}\hlstd{data)}
\end{alltt}
\begin{verbatim}
## List of 2
##  $ crown: num [1:30, 1:48] 0.3079 0.6531 0.5089 -0.1652 -0.0419 ...
##   ..- attr(*, "dimnames")=List of 2
##   .. ..$ : chr [1:30] "Dasypodidae" "Bradypus" "Myrmecophagidae" "Todralestes" ...
##   .. ..$ : NULL
##  $ stem : num [1:20, 1:48] -0.739 -0.68 -0.511 -0.477 -0.473 ...
##   ..- attr(*, "dimnames")=List of 2
##   .. ..$ : chr [1:20] "Daulestes" "Bulaklestes" "Uchkudukodon" "Kennalestes" ...
##   .. ..$ : NULL
\end{verbatim}
\begin{alltt}
\hlcom{## "taxa" being the list of taxa in the original ordinated matrix}
\hlkwd{str}\hlstd{(crown_stem}\hlopt{$}\hlstd{taxa)}
\end{alltt}
\begin{verbatim}
##  chr [1:50] "Cimolestes" "Maelestes" "Batodon" "Bulaklestes" "Daulestes" ...
\end{verbatim}
\begin{alltt}
\hlcom{## "series" containing information on the series type (custom) and names (crown and stem)}
\hlstd{crown_stem}\hlopt{$}\hlstd{series}
\end{alltt}
\begin{verbatim}
## [1] "custom" "crown"  "stem"
\end{verbatim}
\end{kframe}
\end{knitrout}

Of course, using phylogeny as a factor is just an example.
Any type of factors can be used in this example (e.g. body mass categories, habitat, diet, etc...).
Which leads us to another type of category used a lot in disparity-through-time analysis: time!

\subsubsection{Time splitting}
\texttt{time.series} is a function that allows to split the matrix in different ways using time as a category.
This functions needs as input an ordinated matrix and a matching phylogenetic tree.
Two types of time series splitting can be performed with the \dispRity package by using the \texttt{method} option in \texttt{time.series}.
\begin{enumerate}
\item the classical discrete time splitting (or time-binning) using \texttt{method = "discrete"};
\item or a new continuous time splitting (or time-slicing) using \texttt{method = "continuous"}.
\end{enumerate}
For the time-slicing method details, see Guillerme and Cooper \textit{in prep.} \cite{GuillermeSTD}.
Once the method is chosen, the function asks to specify the \texttt{time} which can be given as a vector of \texttt{numeric} values for:
\begin{enumerate}
\item defining the boundaries of the time bins (when \texttt{method = "discrete"});
\item defining the time-slicing places (when using \texttt{method = "continuous"}).
\end{enumerate}
Otherwise, the \texttt{time} argument can be set as a single \texttt{numeric} value for automatically generating a fix number of equidistant time-bins/slices.
Additionally, we can also input a data frame containing the first/last occurrence data (\texttt{FADLAD}) for taxa that span over a longer time than the tips/nodes age.

Let's see and example for time-binning (\texttt{method = "discrete"}):

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Let's generate three time bins containing the data present every 40 Ma}
\hlstd{time_bins} \hlkwb{<-} \hlkwd{time.series}\hlstd{(}\hlkwc{data} \hlstd{= BeckLee_mat50,} \hlkwc{tree} \hlstd{= BeckLee_tree,}
    \hlkwc{method} \hlstd{=} \hlstr{"discrete"}\hlstd{,} \hlkwc{time} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{120}\hlstd{,} \hlnum{80}\hlstd{,} \hlnum{40}\hlstd{,} \hlnum{0}\hlstd{))}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# No FADLAD table has been provided so every tip is assumed to interval single points in time.}}\begin{alltt}
\hlcom{## Note that the function provides a warning saying that tips where single}
\hlcom{## points in time (no FAD/LAD information). We can fix that by adding the}
\hlcom{## age data for the taxa that have some longer occurrence spans.}
\hlstd{time_bins} \hlkwb{<-} \hlkwd{time.series}\hlstd{(}\hlkwc{data} \hlstd{= BeckLee_mat50,} \hlkwc{tree} \hlstd{= BeckLee_tree,}
    \hlkwc{method} \hlstd{=} \hlstr{"discrete"}\hlstd{,} \hlkwc{time} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{120}\hlstd{,} \hlnum{80}\hlstd{,} \hlnum{40}\hlstd{,} \hlnum{0}\hlstd{),} \hlkwc{FADLAD} \hlstd{= BeckLee_ages)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Some tips have FAD/LAD and are assumed to interval single points in time.}}\begin{alltt}
\hlcom{## To entirely avoid the warning we could collect the occurrence span data}
\hlcom{## for all the taxa but that's not necessary. The function automatically}
\hlcom{## assumes no occurrence span time (i.e. single points in time) for all taxa}
\hlcom{## by default.}

\hlstd{time_bins}
\end{alltt}
\begin{verbatim}
## 3 discrete series for 50 taxa. 
## Series:
## 120-80, 80-40, 40-0.
\end{verbatim}
\end{kframe}
\end{knitrout}

This generated indeed a list of 3 sub matrices.
Note that we can also generate equivalent results by just telling the function that we want three time-bins (series) as follow: 

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{time.series}\hlstd{(}\hlkwc{data} \hlstd{= BeckLee_mat50,} \hlkwc{tree} \hlstd{= BeckLee_tree,} \hlkwc{method} \hlstd{=} \hlstr{"discrete"}\hlstd{,} \hlkwc{time} \hlstd{=} \hlnum{3}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# No FADLAD table has been provided so every tip is assumed to interval single points in time.}}\begin{verbatim}
## 3 discrete series for 50 taxa. 
## Series:
## 133.51104-89.00736, 89.00736-44.50368, 44.50368-0.
\end{verbatim}
\end{kframe}
\end{knitrout}
We now have three time bins of 44.50368 Ma each. But hey, that's a bit silly, let's stick to bins of 40 Ma.
Note that we can also ask to include nodes in each bin by using \texttt{inc.nodes = TRUE} and providing a matrix that contains the ordinated distance between taxa AND nodes.

For the time-slicing method (\texttt{method = "continuous"}), the idea is pretty similar.
We just need to provide a matrix that contains the ordinated distance between taxa AND nodes and an evolutionary model via the \texttt{model} argument.
For now they are four evolutionary models implemented \cite{GuillermeSTD}:
\begin{enumerate}
\item \texttt{"acctran"} where the data chosen on each time slice is always the one of the offspring
\item \texttt{"deltran"} where the data chosen on each time slice is always the one of the descendant
\item \texttt{"punctuated"} where the data chosen on each time slice is randomly chosen between the offspring or the descendant
\item \texttt{"gradual"} where the data chosen on each time slice is either the offspring or the descendant depending on branch length
\end{enumerate}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Let's generate four time slices every 40 Ma}
\hlstd{time_slices} \hlkwb{<-} \hlkwd{time.series}\hlstd{(}\hlkwc{data} \hlstd{= BeckLee_mat99,} \hlkwc{tree} \hlstd{= BeckLee_tree,}
    \hlkwc{method} \hlstd{=} \hlstr{"continuous"}\hlstd{,} \hlkwc{model} \hlstd{=} \hlstr{"gradual"}\hlstd{,} \hlkwc{time} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{120}\hlstd{,} \hlnum{80}\hlstd{,} \hlnum{40}\hlstd{,} \hlnum{0}\hlstd{),}
    \hlkwc{FADLAD} \hlstd{= BeckLee_ages)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Some tips have FAD/LAD and are assumed to interval single points in time.}}\begin{alltt}
\hlstd{time_slices}
\end{alltt}
\begin{verbatim}
## 4 continuous series for 99 taxa. 
## Series:
## 120, 80, 40, 0.
\end{verbatim}
\begin{alltt}
\hlcom{## Note that in the same way as for the discrete method, we can also}
\hlcom{## automatically generate the slices}
\hlkwd{time.series}\hlstd{(}\hlkwc{data} \hlstd{= BeckLee_mat99,} \hlkwc{tree} \hlstd{= BeckLee_tree,} \hlkwc{method} \hlstd{=} \hlstr{"continuous"}\hlstd{,}
    \hlkwc{model} \hlstd{=} \hlstr{"gradual"}\hlstd{,} \hlkwc{time} \hlstd{=} \hlnum{4}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# No FADLAD table has been provided so every tip is assumed to interval single points in time.}}\begin{verbatim}
## 4 continuous series for 99 taxa. 
## Series:
## 133.51104, 89.00736, 44.50368, 0.
\end{verbatim}
\begin{alltt}
\hlcom{## But that gives the same silly results (slicing ~ 44.50368 Ma)}
\end{alltt}
\end{kframe}
\end{knitrout}

\subsection{Bootstrapping the data}
To measure how robust is the data, we can perform bootstrap pseudo-replications or rarefaction analysis to make sure the results are not dependant on weird outliers.
The \texttt{boot.matrix} allows to bootstraps and rarefy ordinated matrices in a fast and easy way.
The default options will bootstrap the matrix 1000 times with no rarefaction.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{boot.matrix}\hlstd{(}\hlkwc{data} \hlstd{= BeckLee_mat50)}
\end{alltt}
\begin{verbatim}
## Bootstrapped ordinated matrix with 50 taxa. 
## 1 unnamed series.
## Data was bootstrapped 1000 times, using the full bootstrap method.
\end{verbatim}
\begin{alltt}
\hlcom{## As we can wee, the output is also a dispRity object that is summarised}
\hlcom{## automatically, giving information on the data as well as the number of}
\hlcom{## bootstraps and the bootstraps methods.}
\end{alltt}
\end{kframe}
\end{knitrout}

This function proposes the user to specify the bootstrap algorithm with the \texttt{boot.type} method.
Currently two algorithms are implemented:
\begin{enumerate}
\item \texttt{"full"} where the bootstrapping is entirely stochastic (all the data is bootstrapped)
\item \texttt{"single"} where only one random taxa is replaced by one other random taxa each pseudo-replication
\end{enumerate}
This function also has a \texttt{rarefaction} option to rarefy the data (how unexpected!).
The default status is \texttt{FALSE} but it can be set to \texttt{TRUE} to fully rarefy the data (i.e. remove $n$ taxa for the number of pseudo-replicates, where $n$ varies from the maximum number of taxa present in the dataset to a minimum of 3 taxa).
It can also be set to a fix \texttt{numeric} value (or a set of numeric values).
Finally, the last option from this function, \texttt{rm.last.axis}, is whether to remove a certain amount of axis of the ordinated data.
This option can be logical where \texttt{FALSE} (default) will not remove any axis and \texttt{TRUE} will remove the 5\% last axis or it can be set to a user defined proportion.
This is a common practice in disparity-through-time analysis but it is hard to justify statistically.
Here is a series of examples:

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Bootstrapping with the single bootstrap method}
\hlkwd{boot.matrix}\hlstd{(BeckLee_mat50,} \hlkwc{boot.type} \hlstd{=} \hlstr{"single"}\hlstd{)}
\end{alltt}
\begin{verbatim}
## Bootstrapped ordinated matrix with 50 taxa. 
## 1 unnamed series.
## Data was bootstrapped 1000 times, using the single bootstrap method.
\end{verbatim}
\begin{alltt}
\hlcom{## Bootstrapping with the full rarefaction}
\hlkwd{boot.matrix}\hlstd{(BeckLee_mat50,} \hlkwc{bootstraps} \hlstd{=} \hlnum{20}\hlstd{,} \hlkwc{rarefaction} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\end{alltt}
\begin{verbatim}
## Bootstrapped ordinated matrix with 50 taxa. 
## 1 unnamed series.
## Data was bootstrapped 20 times, using the full bootstrap method.
## Data was fully rarefied (down to 3 taxa).
\end{verbatim}
\begin{alltt}
\hlcom{## Or with a set number of rarefaction levels}
\hlkwd{boot.matrix}\hlstd{(BeckLee_mat50,} \hlkwc{bootstraps} \hlstd{=} \hlnum{20}\hlstd{,} \hlkwc{rarefaction} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{6}\hlopt{:}\hlnum{8}\hlstd{,}\hlnum{3}\hlstd{))}
\end{alltt}
\begin{verbatim}
## Bootstrapped ordinated matrix with 50 taxa. 
## 1 unnamed series.
## Data was bootstrapped 20 times, using the full bootstrap method.
## Data was rarefied with a maximum of 6, 7, 8 and 3 taxa.
\end{verbatim}
\begin{alltt}
\hlcom{## And removing the last axis (default)}
\hlkwd{boot.matrix}\hlstd{(BeckLee_mat50,} \hlkwc{rm.last.axis} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\end{alltt}
\begin{verbatim}
## Bootstrapped ordinated matrix with 50 taxa. 
## 1 unnamed series.
## Data was bootstrapped 1000 times, using the full bootstrap method. 
## The 6 last axis have been removed from the original data.
\end{verbatim}
\begin{alltt}
\hlcom{## Or with a fix value (50%)}
\hlkwd{boot.matrix}\hlstd{(BeckLee_mat50,} \hlkwc{rm.last.axis} \hlstd{=} \hlnum{0.5}\hlstd{)}
\end{alltt}
\begin{verbatim}
## Bootstrapped ordinated matrix with 50 taxa. 
## 1 unnamed series.
## Data was bootstrapped 1000 times, using the full bootstrap method. 
## The 35 last axis have been removed from the original data.
\end{verbatim}
\end{kframe}
\end{knitrout}

Okay, that's all well and good but this function can also deal with a list of matrices or with a \dispRity object output from the \texttt{cust.series} or \texttt{time.series} functions.
Like this:

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Let's do a full rarefaction on the crown/stem data for later}
\hlstd{crown_stemBS} \hlkwb{<-} \hlkwd{boot.matrix}\hlstd{(crown_stem,} \hlkwc{rarefaction} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlcom{## And just bootstrapping for the time binning/slicing}
\hlstd{time_binsBS} \hlkwb{<-} \hlkwd{boot.matrix}\hlstd{(time_bins)}
\hlstd{time_slicesBS} \hlkwb{<-} \hlkwd{boot.matrix}\hlstd{(time_slices)}

\hlcom{## And just to remind us what's in each objects}
\hlstd{crown_stemBS}
\end{alltt}
\begin{verbatim}
## Bootstrapped ordinated matrix with 50 taxa. 
## Series:
## crown, stem.
## Data was split using custom method.
## Data was bootstrapped 1000 times, using the full bootstrap method.
## Data was fully rarefied (down to 3 taxa).
\end{verbatim}
\begin{alltt}
\hlstd{time_binsBS}
\end{alltt}
\begin{verbatim}
## Bootstrapped ordinated matrix with 50 taxa. 
## Series:
## 120-80, 80-40, 40-0.
## Data was split using discrete method.
## Data was bootstrapped 1000 times, using the full bootstrap method.
\end{verbatim}
\begin{alltt}
\hlstd{time_slicesBS}
\end{alltt}
\begin{verbatim}
## Bootstrapped ordinated matrix with 99 taxa. 
## Series:
## 120, 80, 40, 0.
## Data was split using continuous method.
## Data was bootstrapped 1000 times, using the full bootstrap method.
\end{verbatim}
\end{kframe}
\end{knitrout}

\subsection{Calculating disparity}
Until now, all the functions where merely splitting and bootstrapping matrices.
Now we're going to see the functionalities of the core function of this package: the \dispRity function.
This function is a modulable function that allow to simply (and quickly!) calculate disparity from a matrix.
Wait, what's modulable? and back to the introduction, what's disparity?

Because disparity can be measured in many ways, this function is just a tool to measure the disparity \textit{as defined by the user} (and here's where the modulable part comes in).
In fact, the \dispRity function intakes two main arguments: the data and the disparity metric.
The disparity metric boils down to a single value that describes the matrix.
Some are really classic like the sum or the products of the ranges or the variances of the matrix columns \cite{Wills1994} (i.e. the any-o-space dimensions).
However, many more exist like the median distances between the taxa and the any-o-space centroid \cite{GuillermeSTD}.

One can usually decompose the disparity metrics into two elements:
\begin{enumerate}
\item the \textbf{class metric} that is typically a descriptor of the matrix. For example describing the ranges of each column in the matrix or the euclidean distance between each row and the centroid of the matrix.
\item the \textbf{summary metric} that is typically a summarise of the class metric values. For example, the sum of the ranges or the median euclidean distance. 
\end{enumerate}
Basically the combination can be infinite between the class and summary metrics.
For example, people might want to measure the median variance of the axis or the product of the distance from the centroid.
However, it is probable that some metrics are better to reflect some biological aspects of the any-o-space than others...

In practice, the \dispRity function intakes a pair of class and summary metrics as a definition of disparity.
Several of these metrics are implemented in other packages (like \texttt{stats::median}, \texttt{base::sum}, etc.) and this package proposes several metrics listed in \texttt{dispRity.metric}:

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlopt{?}\hlstd{dispRity.metric}
\end{alltt}
\end{kframe}
\end{knitrout}

It is even possible to use your very own class and summary metrics!
This will be actually heavily encouraged and facilitate with the \texttt{make.metric} function in a future version (see \ref{whatsleft}).

To use these metrics pairs in the \dispRity function, it's pretty easy:

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlkwd{dispRity}\hlstd{(BeckLee_mat50,} \hlkwc{metric} \hlstd{=} \hlkwd{c}\hlstd{(sum, ranges))}
\end{alltt}
\begin{verbatim}
## Disparity measurements across 1 series for 50 taxa. 
## 1 unnamed series.
## Disparity calculated as: sum ranges for 48 dimensions.
\end{verbatim}
\begin{alltt}
\hlcom{## Yep, that's it. The order of the metrics does not matter (the function detects}
\hlcom{## automatically which one is the class and the summary metric) so the combinations}
\hlcom{## are high!}
\hlkwd{dispRity}\hlstd{(BeckLee_mat50,} \hlkwc{metric} \hlstd{=} \hlkwd{c}\hlstd{(sum, variances))}
\end{alltt}
\begin{verbatim}
## Disparity measurements across 1 series for 50 taxa. 
## 1 unnamed series.
## Disparity calculated as: sum variances for 48 dimensions.
\end{verbatim}
\begin{alltt}
\hlkwd{dispRity}\hlstd{(BeckLee_mat50,} \hlkwc{metric} \hlstd{=} \hlkwd{c}\hlstd{(prod, centroids))}
\end{alltt}
\begin{verbatim}
## Disparity measurements across 1 series for 50 taxa. 
## 1 unnamed series.
## Disparity calculated as: prod centroids for 48 dimensions.
\end{verbatim}
\begin{alltt}
\hlkwd{dispRity}\hlstd{(BeckLee_mat50,} \hlkwc{metric} \hlstd{=} \hlkwd{c}\hlstd{(mode.val, ranges))}
\end{alltt}
\begin{verbatim}
## Disparity measurements across 1 series for 50 taxa. 
## 1 unnamed series.
## Disparity calculated as: mode.val ranges for 48 dimensions.
\end{verbatim}
\end{kframe}
\end{knitrout}

Of course, this function can take an ordinated matrix but, more interesting it can also deal with a list of matrices (from the \texttt{cust.series} or \texttt{time.series} functions for example) or a bootstrapped or/and rarefied matrix (from the \texttt{boot.matrix} function for example).

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## For example, let's calculate the sum of ranges from our crown/stem mammals}
\hlkwd{dispRity}\hlstd{(crown_stem,} \hlkwc{metric} \hlstd{=} \hlkwd{c}\hlstd{(sum, ranges))}
\end{alltt}
\begin{verbatim}
## Disparity measurements across 2 series for 50 taxa. 
## Series:
## crown, stem.
## Disparity calculated as: sum ranges for 48 dimensions.
## Data was split using custom method.
\end{verbatim}
\begin{alltt}
\hlcom{## Or even better, from the bootstrapped data}
\hlstd{disp_crown_stemBS} \hlkwb{<-} \hlkwd{dispRity}\hlstd{(crown_stemBS,} \hlkwc{metric} \hlstd{=} \hlkwd{c}\hlstd{(sum, ranges))}
\hlcom{## Note that the bootstrapped + rarefied data takes some time to run (it's}
\hlcom{## calculating disparity from 46 matrices!)}

\hlcom{## Let's calculate a different metric for the disparity-through-time analysis}
\hlstd{disp_time_binsBS} \hlkwb{<-} \hlkwd{dispRity}\hlstd{(time_binsBS,} \hlkwc{metric} \hlstd{=} \hlkwd{c}\hlstd{(median, centroids))}
\hlstd{disp_time_slicesBS} \hlkwb{<-} \hlkwd{dispRity}\hlstd{(time_slicesBS,} \hlkwc{metric} \hlstd{=} \hlkwd{c}\hlstd{(median, centroids))}
\end{alltt}
\end{kframe}
\end{knitrout}

Again, note that the results are \dispRity objects and can displayed through the S3 \texttt{print.dispRity} method to remind users what are in these objects.

\subsection{Summarising the results}
Finally, after calculating disparity, probably the main thing we want to do is actually see the values of the disparity metrics, either in a table or in a plot.
Well, that again is easily doable by using the S3 \texttt{summary.dispRity} and \texttt{plot.dispRity} functions.

\subsubsection{\texttt{summary} function}
This function intakes a \dispRity object plus various options namely the \texttt{CI} values for the confidence intervals levels; the \texttt{cent.tend} for the central tendency to use for summarising the results and to "graphical" options which are whether to recall the \dispRity options and how much digits are wanted in the results.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Let's have a look at the disparity-through-time using in the time-binned data}
\hlkwd{summary}\hlstd{(disp_time_binsBS)}
\end{alltt}
\begin{verbatim}
##   series  n  mean  2.5%   25%   75% 97.5%
## 1 120-80  8 1.114 0.915 1.080 1.167 1.235
## 2  80-40 27 1.322 1.274 1.308 1.338 1.358
## 3   40-0 16 1.324 1.248 1.306 1.345 1.372
\end{verbatim}
\begin{alltt}
\hlcom{## The CIs are calculated as 50 and 95 and the central tendency is the mean by default.}
\hlcom{## We can change that easily by specifying different values in the options}
\hlkwd{summary}\hlstd{(disp_time_binsBS,} \hlkwc{CI} \hlstd{=} \hlnum{25}\hlstd{,} \hlkwc{cent.tend} \hlstd{= median,} \hlkwc{rounding} \hlstd{=} \hlnum{0}\hlstd{)}
\end{alltt}
\begin{verbatim}
##   series  n median 37.5% 62.5%
## 1 120-80  8      1     1     1
## 2  80-40 27      1     1     1
## 3   40-0 16      1     1     1
\end{verbatim}
\begin{alltt}
\hlcom{## Also, if we happen to have forgotten what was in the disp_time_binsBS object (as in which}
\hlcom{## options where used to modify the original matrix) we can use the recall option}
\hlkwd{summary}\hlstd{(disp_time_binsBS,} \hlkwc{recall} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\end{alltt}
\begin{verbatim}
## Disparity calculated as: median centroids for 48 dimensions.
## Data was split using discrete method.
## Data was bootstrapped 1000 times, using the full bootstrap method.
##   series  n  mean  2.5%   25%   75% 97.5%
## 1 120-80  8 1.114 0.915 1.080 1.167 1.235
## 2  80-40 27 1.322 1.274 1.308 1.338 1.358
## 3   40-0 16 1.324 1.248 1.306 1.345 1.372
\end{verbatim}
\begin{alltt}
\hlcom{## Note that the recall just prints text. The output of summary.dispRity is always a data.frame}
\hlstd{summary_table} \hlkwb{<-} \hlkwd{summary}\hlstd{(disp_time_binsBS,} \hlkwc{recall} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\end{alltt}
\begin{verbatim}
## Disparity calculated as: median centroids for 48 dimensions.
## Data was split using discrete method.
## Data was bootstrapped 1000 times, using the full bootstrap method.
\end{verbatim}
\begin{alltt}
\hlkwd{class}\hlstd{(summary_table)}
\end{alltt}
\begin{verbatim}
## [1] "data.frame"
\end{verbatim}
\begin{alltt}
\hlcom{## Finally we can see the results of the rarefaction analysis for the crown/stem data}
\hlkwd{head}\hlstd{(}\hlkwd{summary}\hlstd{(disp_crown_stemBS))}
\end{alltt}
\begin{verbatim}
##   series n  mean  2.5%   25%   75% 97.5%
## 1  crown 3 15.19 10.19 15.17 16.08 16.66
## 2  crown 4 18.47 14.97 18.40 19.41 19.89
## 3  crown 5 20.83 17.99 19.66 21.81 22.46
## 4  crown 6 22.60 18.84 21.68 23.77 24.51
## 5  crown 7 24.23 21.16 23.49 25.32 26.15
## 6  crown 8 25.46 22.40 24.82 26.51 27.42
\end{verbatim}
\begin{alltt}
\hlcom{## This outputs a longer table with all the variations of the number of crown/stem taxa}
\hlcom{## from the maximum (30 and 20) to the minimum (3)}
\end{alltt}
\end{kframe}
\end{knitrout}

\subsubsection{\texttt{plot} function}
Finally, this function allows to visualise the disparity results in a often nicer fashion than just a table (even though it tends to be the exact same data).
The \texttt{plot.dispRity} option intakes the same options as \texttt{summary.dispRity} along side with various graphical options described in the function manual.
Here, let's just have a look a few of these options.

Let's start with plotting the difference in disparity between the crown and the stem mammals.
For this we are going to simply specify the type of plots using the \texttt{type} option that allows to choose between the \texttt{"continuous"} or \texttt{"discrete"} method.
In our case, we are interested in looking at the results in a discrete way.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Graphical options}
\hlkwd{quartz}\hlstd{(}\hlkwc{width} \hlstd{=} \hlnum{15}\hlstd{,} \hlkwc{height} \hlstd{=} \hlnum{5}\hlstd{) ;} \hlkwd{par}\hlstd{(}\hlkwc{mfrow} \hlstd{= (}\hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,}\hlnum{3}\hlstd{)),} \hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}

\hlcom{## Plotting the score for both groups}
\hlkwd{plot}\hlstd{(disp_crown_stemBS,} \hlkwc{type} \hlstd{=} \hlstr{"discrete"} \hlstd{,} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{25}\hlstd{,}\hlnum{40}\hlstd{))}

\hlcom{## Same one with the number of taxa for each data set}
\hlkwd{plot}\hlstd{(disp_crown_stemBS,} \hlkwc{type} \hlstd{=} \hlstr{"discrete"}\hlstd{,} \hlkwc{diversity} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{25}\hlstd{,}\hlnum{40}\hlstd{))}

\hlcom{## Same one with rarefied data (note how that affects the diversity data as well!)}
\hlkwd{plot}\hlstd{(disp_crown_stemBS,} \hlkwc{type} \hlstd{=} \hlstr{"discrete"}\hlstd{,} \hlkwc{diversity} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{rarefaction} \hlstd{=} \hlnum{20}\hlstd{,} \hlkwc{ylim} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{25}\hlstd{,}\hlnum{40}\hlstd{))}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=1\linewidth]{figure/minimal-plot1-1} 

}



\end{knitrout}

The grey squares represent the confidence intervals (50 in dark grey and 90 in light grey) and the dot represents the mean. As we can see, the disparity seems a bit higher in crown mammals.
Now that can be due just to the difference in the number of species in both crown and stem mammals.
By the way, how many taxa where in each group? We can look at that by using the \texttt{diversity} option.

This shows that the number of taxa is higher (30) in crown mammals than in stem ones (20), that is why it is maybe interesting to look at the rarefied data using the \texttt{rarefaction} option.
This option can be either \texttt{FALSE} (default) for always plotting the maximum number of taxa per series or \texttt{TRUE} to always plot the minimum.
Additionally, it can be a specific number to plot a specific number of taxa.
Let say we want both groups to have 20 taxa maximum.

We can see now that the confidence intervals overlap more than previously
To understand how the number of taxa affects each series, we can use the \texttt{rarefaction = "plot"} function to plot the rarefaction curves.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Graphical options}
\hlkwd{par}\hlstd{(}\hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}

\hlcom{## The rarefaction curves}
\hlkwd{plot}\hlstd{(disp_crown_stemBS,} \hlkwc{type} \hlstd{=} \hlstr{"discrete"}\hlstd{,} \hlkwc{diversity} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{rarefaction} \hlstd{=} \hlstr{"plot"}\hlstd{)}
\hlcom{## Note that the function automatically draws the curves for each series and splits}
\hlcom{## the plot screen accordingly.}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=0.5\linewidth]{figure/minimal-plot2-1} 

}



\end{knitrout}

The different dashed lines represent the different confidence intervals.

Additionally, for the \texttt{type = "discrete"} option, we might also decide to plot many boxplots (which can be a bit messy).
The \texttt{discrete\_type} option allows to switch between \texttt{"box"} or \texttt{"line"} for showing the results in one or the other format.
Let's look at that with the time binned data (even though there is only three time bins).

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Graphical options}
\hlkwd{quartz}\hlstd{(}\hlkwc{width} \hlstd{=} \hlnum{10}\hlstd{,} \hlkwc{height} \hlstd{=} \hlnum{5}\hlstd{) ;} \hlkwd{par}\hlstd{(}\hlkwc{mfrow} \hlstd{= (}\hlkwd{c}\hlstd{(}\hlnum{1}\hlstd{,}\hlnum{2}\hlstd{)),} \hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}

\hlcom{## The disparity-through-time data in a time-binned way}
\hlkwd{plot}\hlstd{(disp_time_binsBS,} \hlkwc{type} \hlstd{=} \hlstr{"discrete"}\hlstd{,} \hlkwc{discrete_type} \hlstd{=} \hlstr{"line"}\hlstd{)}

\hlcom{## The disparity-through-time data in a time-sliced ways}
\hlkwd{plot}\hlstd{(disp_time_slicesBS,} \hlkwc{type} \hlstd{=} \hlstr{"continuous"}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=1\linewidth]{figure/minimal-plot3-1} 

}



\end{knitrout}

Finally, we can use the \texttt{type = "continuous"} option that comes in handy for plotting continuous data like in the time sliced analysis (obviously...).

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Graphical options}
\hlkwd{par}\hlstd{(}\hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}

\hlcom{## First, plotting the continuous data}
\hlkwd{plot}\hlstd{(disp_time_slicesBS,} \hlkwc{type} \hlstd{=} \hlstr{"continuous"}\hlstd{,} \hlkwc{ylim}\hlstd{=}\hlkwd{c}\hlstd{(}\hlnum{0.5}\hlstd{,}\hlnum{2}\hlstd{))}

\hlcom{## Second, adding the discrete data}
\hlkwd{par}\hlstd{(}\hlkwc{new} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlkwd{plot}\hlstd{(disp_time_binsBS,} \hlkwc{type} \hlstd{=} \hlstr{"discrete"}\hlstd{,} \hlkwc{discrete_type} \hlstd{=} \hlstr{"line"}\hlstd{,} \hlkwc{ylim}\hlstd{=}\hlkwd{c}\hlstd{(}\hlnum{0.5}\hlstd{,}\hlnum{2}\hlstd{),} \hlkwc{xlab}\hlstd{=}\hlstr{""}\hlstd{,} \hlkwc{ylab}\hlstd{=}\hlstr{""}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=.5\linewidth]{figure/minimal-plot4-1} 

}



\end{knitrout}

I encourage you to play with the graphical options to have some prettier results.
Note that most of the options from \texttt{plot} can be passed to \texttt{plot.dispRity} via \texttt{...}.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{## Graphical options}
\hlkwd{par}\hlstd{(}\hlkwc{bty} \hlstd{=} \hlstr{"n"}\hlstd{)}

\hlcom{## A plot with many options!}
\hlkwd{plot}\hlstd{(disp_time_slicesBS,} \hlkwc{CI} \hlstd{=} \hlkwd{c}\hlstd{(}\hlnum{50}\hlstd{,} \hlnum{75}\hlstd{,} \hlnum{95}\hlstd{),} \hlkwc{cent.tend} \hlstd{= median,} \hlkwc{type} \hlstd{=} \hlstr{"continuous"}\hlstd{,}
    \hlkwc{diversity} \hlstd{=} \hlnum{TRUE}\hlstd{,} \hlkwc{col} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"black"}\hlstd{,} \hlstr{"red"}\hlstd{,} \hlstr{"orange"}\hlstd{,} \hlstr{"yellow"}\hlstd{),} \hlkwc{ylab} \hlstd{=} \hlkwd{c}\hlstd{(}\hlstr{"Disparity"}\hlstd{,} \hlstr{"Diversity"}\hlstd{),}
    \hlkwc{xlab} \hlstd{=} \hlstr{"Time (in in units from past to present)"}\hlstd{,} \hlkwc{time.series} \hlstd{=} \hlnum{FALSE}\hlstd{,} \hlkwc{main} \hlstd{=} \hlstr{"Many options..."}\hlstd{)}
\end{alltt}
\end{kframe}

{\centering \includegraphics[width=.5\linewidth]{figure/minimal-plot5-1} 

}



\end{knitrout}

\section{What's left?}
\label{whatsleft}
\subsection{Some statistics}
\subsection{Users defined metrics}
\subsection{More user defined stuff}

\bibliographystyle{vancouver}
\bibliography{References}

\end{document}
